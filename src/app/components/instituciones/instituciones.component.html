<!-- src/app/components/instituciones/instituciones.component.html -->
<div class="instituciones-container">
  <!-- Header -->
  <div class="page-header">
    <h1>üè¢ Gesti√≥n de Instituciones</h1>
    <button class="btn btn-primary" (click)="abrirModal('create')">
      ‚ûï Nueva Instituci√≥n
    </button>
  </div>

  <!-- Alertas -->
  <div *ngIf="error" class="alert alert-error">
    ‚ùå {{ error }}
  </div>
  
  <div *ngIf="success" class="alert alert-success">
    ‚úÖ {{ success }}
  </div>

  <!-- Filtros -->
  <div class="filters-section">
    <div class="filters-row">
      <div class="filter-group">
        <label>Buscar:</label>
        <input 
          type="text" 
          [(ngModel)]="searchTerm" 
          placeholder="Nombre, email o descripci√≥n..."
          class="form-control">
      </div>
      
      <div class="filter-group">
        <label>Estado:</label>
        <select [(ngModel)]="filtroEstado" class="form-control">
          <option value="">Todos los estados</option>
          <option *ngFor="let estado of estados" [value]="estado.value">
            {{ estado.label }}
          </option>
        </select>
      </div>
      
      <div class="filter-group">
        <!-- Espacio para m√°s filtros -->
      </div>
    </div>
  </div>

  <!-- Loading -->
  <div *ngIf="loading" class="loading">
    <p>‚è≥ Cargando instituciones...</p>
  </div>

  <!-- Tabla de instituciones -->
  <div *ngIf="!loading" class="instituciones-table">
    <div class="table-info">
      <p>Total de instituciones: <strong>{{ institucionesFiltradas.length }}</strong></p>
    </div>

    <div class="table-container">
      <table class="table">
        <thead>
          <tr>
            <th>ID</th>
            <th>Nombre</th>
            <th>Email</th>
            <th>Tel√©fono</th>
            <th>Direcci√≥n</th>
            <th>Estado</th>
            <th>Fecha Creaci√≥n</th>
            <th>Acciones</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let institucion of institucionesFiltradas" 
              [class.inactive]="institucion.estado === 'inactiva'">
            <td>{{ institucion.id }}</td>
            <td>
              <div class="institucion-name">
                <strong>{{ institucion.nombre }}</strong>
                <small *ngIf="institucion.descripcion">{{ institucion.descripcion }}</small>
              </div>
            </td>
            <td>{{ institucion.email }}</td>
            <td>{{ institucion.telefono || '-' }}</td>
            <td>{{ institucion.direccion || '-' }}</td>
            <td>
              <span class="status" [class]="'status-' + institucion.estado">
                {{ getEstadoLabel(institucion.estado || 'activa') }}
              </span>
            </td>
            <td>
              <small>{{ institucion.fecha_creacion | date:'dd/MM/yyyy HH:mm' }}</small>
            </td>
            <td>
              <div class="actions">
                <button 
                  class="btn btn-sm btn-secondary" 
                  (click)="abrirModal('view', institucion)"
                  title="Ver detalles">
                  üëÅÔ∏è
                </button>
                <button 
                  class="btn btn-sm btn-primary" 
                  (click)="abrirModal('edit', institucion)"
                  title="Editar">
                  ‚úèÔ∏è
                </button>
                <button 
                  class="btn btn-sm btn-danger" 
                  (click)="eliminarInstitucion(institucion)"
                  title="Eliminar">
                  üóëÔ∏è
                </button>
              </div>
            </td>
          </tr>
        </tbody>
      </table>

      <!-- Estado vac√≠o -->
      <div *ngIf="institucionesFiltradas.length === 0" class="empty-state">
        <p>üè¢ No se encontraron instituciones con los filtros aplicados</p>
        <button class="btn btn-primary" (click)="abrirModal('create')">
          Crear primera instituci√≥n
        </button>
      </div>
    </div>
  </div>
</div>

<!-- Modal -->
<div *ngIf="showModal" class="modal-overlay" (click)="cerrarModal()">
  <div class="modal-content" (click)="$event.stopPropagation()">
    <div class="modal-header">
      <h2>
        <span *ngIf="modalMode === 'create'">‚ûï Crear Instituci√≥n</span>
        <span *ngIf="modalMode === 'edit'">‚úèÔ∏è Editar Instituci√≥n</span>
        <span *ngIf="modalMode === 'view'">üëÅÔ∏è Detalles de la Instituci√≥n</span>
      </h2>
      <button class="btn-close" (click)="cerrarModal()">‚úñÔ∏è</button>
    </div>

    <div class="modal-body">
      <!-- Alertas del modal -->
      <div *ngIf="error" class="alert alert-error">
        ‚ùå {{ error }}
      </div>
      
      <div *ngIf="success" class="alert alert-success">
        ‚úÖ {{ success }}
      </div>

      <!-- Vista de detalles -->
      <div *ngIf="modalMode === 'view' && selectedInstitucion" class="institution-details">
        <div class="detail-row">
          <label>ID:</label>
          <span>{{ selectedInstitucion.id }}</span>
        </div>
        <div class="detail-row">
          <label>Nombre:</label>
          <span>{{ selectedInstitucion.nombre }}</span>
        </div>
        <div class="detail-row" *ngIf="selectedInstitucion.descripcion">
          <label>Descripci√≥n:</label>
          <span>{{ selectedInstitucion.descripcion }}</span>
        </div>
        <div class="detail-row">
          <label>Email:</label>
          <span>{{ selectedInstitucion.email }}</span>
        </div>
        <div class="detail-row" *ngIf="selectedInstitucion.telefono">
          <label>Tel√©fono:</label>
          <span>{{ selectedInstitucion.telefono }}</span>
        </div>
        <div class="detail-row" *ngIf="selectedInstitucion.direccion">
          <label>Direcci√≥n:</label>
          <span>{{ selectedInstitucion.direccion }}</span>
        </div>
        <div class="detail-row" *ngIf="selectedInstitucion.logo_url">
          <label>Logo URL:</label>
          <span>{{ selectedInstitucion.logo_url }}</span>
        </div>
        <div class="detail-row">
          <label>Estado:</label>
          <span class="status" [class]="'status-' + selectedInstitucion.estado">
            {{ getEstadoLabel(selectedInstitucion.estado || 'activa') }}
          </span>
        </div>
        <div class="detail-row">
          <label>Fecha de creaci√≥n:</label>
          <span>{{ selectedInstitucion.fecha_creacion | date:'dd/MM/yyyy HH:mm:ss' }}</span>
        </div>
      </div>

      <!-- Formulario -->
      <form [formGroup]="institucionForm" (ngSubmit)="guardarInstitucion()">
        <div class="form-group">
          <label for="nombre">Nombre *</label>
          <input 
            type="text" 
            id="nombre"
            formControlName="nombre" 
            class="form-control"
            [class.error]="institucionForm.get('nombre')?.touched && institucionForm.get('nombre')?.invalid"
            placeholder="Ej: Club Deportivo River">
          <small *ngIf="institucionForm.get('nombre')?.touched && institucionForm.get('nombre')?.errors?.['required']" 
                 class="error-message">
            El nombre es requerido
          </small>
          <small *ngIf="institucionForm.get('nombre')?.touched && institucionForm.get('nombre')?.errors?.['minlength']" 
                 class="error-message">
            El nombre debe tener al menos 2 caracteres
          </small>
        </div>

        <div class="form-group">
          <label for="descripcion">Descripci√≥n</label>
          <textarea 
            id="descripcion"
            formControlName="descripcion" 
            class="form-control"
            rows="3"
            placeholder="Breve descripci√≥n de la instituci√≥n..."></textarea>
        </div>

        <div class="form-group">
          <label for="email">Email *</label>
          <input 
            type="email" 
            id="email"
            formControlName="email" 
            class="form-control"
            [class.error]="institucionForm.get('email')?.touched && institucionForm.get('email')?.invalid"
            placeholder="contacto@institucion.com">
          <small *ngIf="institucionForm.get('email')?.touched && institucionForm.get('email')?.errors?.['required']" 
                 class="error-message">
            El email es requerido
          </small>
          <small *ngIf="institucionForm.get('email')?.touched && institucionForm.get('email')?.errors?.['email']" 
                 class="error-message">
            El formato del email no es v√°lido
          </small>
        </div>

        <div class="form-row">
          <div class="form-group">
            <label for="telefono">Tel√©fono</label>
            <input 
              type="tel" 
              id="telefono"
              formControlName="telefono" 
              class="form-control"
              placeholder="+54 11 1234-5678">
          </div>

          <div class="form-group">
            <label for="estado">Estado</label>
            <select 
              id="estado"
              formControlName="estado" 
              class="form-control">
              <option *ngFor="let estado of estados" [value]="estado.value">
                {{ estado.label }}
              </option>
            </select>
          </div>
        </div>

        <div class="form-group">
          <label for="direccion">Direcci√≥n</label>
          <input 
            type="text" 
            id="direccion"
            formControlName="direccion" 
            class="form-control"
            placeholder="Calle, n√∫mero, ciudad...">
        </div>

        <div class="form-group">
          <label for="logo_url">URL del Logo</label>
          <input 
            type="url" 
            id="logo_url"
            formControlName="logo_url" 
            class="form-control"
            placeholder="https://ejemplo.com/logo.jpg">
        </div>
      </form>
    </div>

    <div class="modal-footer" *ngIf="modalMode !== 'view'">
      <button type="button" class="btn btn-secondary" (click)="cerrarModal()">
        Cancelar
      </button>
      <button 
        type="submit" 
        class="btn btn-primary" 
        (click)="guardarInstitucion()"
        [disabled]="loading || institucionForm.invalid">
        <span *ngIf="loading">‚è≥</span>
        {{ modalMode === 'create' ? 'Crear Instituci√≥n' : 'Actualizar Instituci√≥n' }}
      </button>
    </div>
  </div>
</div>